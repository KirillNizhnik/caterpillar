var CSE=function(CSE,$){return CSE.form="",CSE.loaded=!1,CSE.jqXHR=!1,CSE.current=[],CSE.previous=[],CSE.fetch=function(){$("html").addClass("loading"),$(".page-content").append('<div class="loading-icon">Searching</div>'),CSE.jqXHR&&4!==CSE.jqXHR.readyState&&CSE.jqXHR.abort(),CSE.previous=CSE.current,CSE.current=CSE.form.serializeArray();var postData={action:"equipment_search_refresh",data:{current:JSON.stringify(CSE.current),previous:JSON.stringify(CSE.previous)}};if("used"===CSE.form.find("#source").val()){var sort={};sort.field="asking_price",sort.order=$("#product-filter__dropdown").val()||"DESC",postData.sort=sort}CSE.jqXHR=$.post(CSE.ajaxurl,postData,function(response){var json=$.parseJSON(response);CSE.render(json)})},CSE.parse_fields=function(json){CSE.jqXHR&&4!==CSE.jqXHR.readyState&&CSE.jqXHR.abort(),CSE.previous=CSE.current,CSE.current=CSE.form.serializeArray(),CSE.jqXHR=$.post(CSE.ajaxurl,{action:"equipment_search_fields",changed:CSE.changed,data:{current:JSON.stringify(CSE.current),previous:JSON.stringify(CSE.previous)}},function(response){var json=$.parseJSON(response);CSE.update_field_options(json)})},CSE.update_field_options=function(json){$.each(json.values,function(name,values){CSE.form.find('[name="'+name+'"]').html(values).trigger("update.fs")})},CSE.inject=function(){$("#search-inject").length&&(CSE.form=$(".page-sidebar .js-search-form"),CSE.changed=$(this).attr("name"),CSE.fieldStates(),CSE.parse_fields(),CSE.fetch())},CSE.render=function(json){$(window).trigger("CSE::beforeRender"),$(".page-content").html(json.template),$(window).trigger("CSE::afterRender"),$("html").removeClass("loading"),$("html,body").animate({scrollTop:$(".page-content").offset().top-100},1e3)},CSE.fieldStates=function(){var fields=CSE.form.find("[data-enabled-field]");fields.each(function(){var f=$(this),src=CSE.form.find('[name="'+f.data("enabled-field")+'"]').val(),val=f.data("enabled-value");src==val?(f.removeAttr("disabled"),f.trigger("enable")):(f.attr("disabled","disabled"),f.trigger("disable"))})},$(function(){$(".js-search-form").on("change","select, input",function(event){CSE.form=$(this).closest(".js-search-form"),CSE.changed=$(this).attr("name"),CSE.fieldStates(),CSE.parse_fields()}),$(".js-search-form").on("submit",function(event){"/equipment/search"===window.location.pathname&&(event.preventDefault(),CSE.fetch())}),CSE.inject()}),CSE}(CSE||{},jQuery);