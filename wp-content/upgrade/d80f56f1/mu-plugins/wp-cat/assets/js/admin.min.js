window.wp=window.wp||{},wp.CAT=function(e,t){return e.Featured={init:function(){t(".post_meta_featured_quick").on("change",this.updateState)},updateState:function(e){var i=t(this),n=i.is(":checked")?1:0;t.post(ajaxurl,{checked:n,post_id:i.data("post_id"),action:"cat_new_update_featured_status"})}},t(function(){wp.CAT.Featured.init()}),e}(wp.CAT||{},jQuery),wp.CAT=function(e,t){return e.Features={init:function(){t(".js-feature-add").length&&this.bind()},bind:function(){t(document).on("click",".js-feature-add",this.addNewField),t(document).on("click",".js-feature-remove",this.removeField),t(".field-list").sortable({items:"li",helper:this.fixWidthHelper})},addNewField:function(e){e.preventDefault();var i=t(this);if($value=i.parent().parent().find(".add-field-name"),""!=$value.val()){var n=_.template(i.closest(".add-new-field").next(".fieldTemplate").html());i.closest(".add-new-field").prev(".field-list").append(n({value:$value.val()})),$value.val("")}else alert("Please fill in the feature.")},removeField:function(e){e.preventDefault(),t(this).parent().fadeOut("fast",function(){t(this).remove()})},fixWidthHelper:function(e,i){return i.children().children().each(function(){t(this).width(t(this).width())}),i}},t(function(){wp.CAT.Features.init()}),e}(wp.CAT||{},jQuery),wp.CAT=function(e,t){return e.TaxonomyImages={Media:null,target:null,init:function(){this.Media=wp.media.frames.downloadable_file=wp.media({title:"Choose an image",button:{text:"Select Image"},multiple:!1}),this.bind()},bind:function(){t(".js-img-add").on("click",this.openMediaFrame),t(".js-img-remove").on("click",this.destroy),this.Media.on("select",t.proxy(this.create,this))},openMediaFrame:function(i){i.preventDefault();var n=e.TaxonomyImages;n.target=t(this),n.Media.open()},create:function(){attachment=this.Media.state().get("selection").first().toJSON();var e=void 0!==attachment.sizes.medium?attachment.sizes.medium.url:attachment.sizes.thumbnail.url;this.target.parent().prepend('<img src="'+e+'" alt="" />'),this.target.siblings(".js-img-input").val(attachment.id),this.target.siblings(".js-img-remove").removeClass("hidden"),this.target.addClass("hidden")},destroy:function(e){e.preventDefault();var i=t(this);i.siblings(".js-img-input").val(""),i.siblings("img").remove(),i.siblings(".js-img-add").removeClass("hidden"),i.addClass("hidden")}},e.MetaImages={Media:null,template:null,init:function(){t("#imageTemplate").length&&(this.Media=wp.media.frames.downloadable_file=wp.media({title:"Select Images",button:{text:"Select Image(s)"},multiple:!0}),this.template=_.template(t("#imageTemplate").html()),this.bind())},bind:function(){t(".js-add-meta-image").on("click",this.openMediaFrame),t("body").on("click",".js-remove-meta-image",this.destroy),t(".js-sortable").sortable({scrollSensitivity:10,scroll:!1,placeholder:"cat-sortable-placeholder"}),this.Media.on("select",t.proxy(this.create,this))},openMediaFrame:function(t){t.preventDefault(),e.MetaImages.Media.open()},create:function(){this.Media.state().get("selection").map(function(e){var i="";void 0!==(e=e.toJSON()).sizes.thumbnail?i=e.sizes.thumbnail.url:void 0!==e.sizes.cat_thumbnail&&(i=e.sizes.cat_thumbnail.url);var n={id:e.id,src:i};t(".js-cat-images").append(this.template(n))},this),t(".js-sortable").sortable("refresh")},destroy:function(e){e.preventDefault(),t(this).parent().remove()}},t(function(){wp.CAT.TaxonomyImages.init(),wp.CAT.MetaImages.init()}),e}(wp.CAT||{},jQuery),wp.CAT=function(e,t){return e.Importer={initialized:!1,init:function(){return this.initialized||this.bind(),this.initialized=!0,this},bind:function(){t(".js-importer-start").on("click",this.start)},start:function(i){i.preventDefault();var n=new e.Progress;n.start();var a=t(this).data("class"),s="cat_new_import_class";"used"===a&&(s="cat_used_import"),"rental"===a&&(s="cat_rental_import"),"rental-purge"===a&&(s="cat_rental_purge"),t.ajax({url:ajaxurl,type:"post",data:{action:s,class_id:a}}).done(function(){n.stop()})}},e.Progress=function(){this.el=null,this.timer=null,this.delay=1e3,this.percent=0,this.text="",this.template='<progress class="progress__bar js-progress-bar" value="0" max="100"></progress><span class="progress__text js-progress-text"></span>'},e.Progress.prototype.start=function(){var e=this;e.el=t(".progress").append(e.template),e.timer=setInterval(function(){e.send()},e.delay)},e.Progress.prototype.stop=function(){clearInterval(this.timer),this.el.empty()},e.Progress.prototype.send=function(){t.ajax({url:ajaxurl,type:"post",data:{action:"cat_progress_poll"},dataType:"json"}).done(t.proxy(this.update,this))},e.Progress.prototype.update=function(e){void 0!==e&&(this.percent=Math.floor(e.indexed/e.total*100),this.text=e.text,this.el.children(".js-progress-bar").val(this.percent),this.el.children(".js-progress-text").html(e.text+" - "+this.percent+"%"))},t(function(){wp.CAT.Importer.init()}),e}(wp.CAT||{},jQuery),wp.CAT=function(e,t){return e.Industries={initialized:!1,nodeTemplate:null,families:{nextIndex:1,models:[]},init:function(){if(t("#familyNodeTemplate").length)return this.nodeTemplate=_.template(t("#familyNodeTemplate").html()),this.initialized||(this.initialized=!0,this.bind()),console.log(window.IndustryFamilies),_.each(window.IndustryFamilies,function(e,t,i){this.create({object_id:"page"==e.type?e.ID:e.term_id,name:e.name,type:e.type})},this),this},bind:function(){t(".js-add-application").on("click",t.proxy(this.createApp,this)),t(".js-submit-add-to-industry").on("click",this.onAddClick),t("body").on("click",".js-remove-node",this.onRemoveClick),t("body").on("industries:addOne",t.proxy(this.addOne,this))},onSelectAllClick:function(e){e.preventDefault(),t(this).closest(".family__terms").find('input[type="checkbox"]').each(function(){t(this).attr("checked","checked")})},onAddClick:function(i){var n=t(this).closest(".family__terms"),a=n.find('input[type="checkbox"]').filter(":checked");t.each(a,function(){var i=t(this);e.Industries.create({object_id:i.val(),name:i.data("name"),type:i.data("type")})}),n.find('input[type="checkbox"]').removeAttr("checked")},onRemoveClick:function(i){i.preventDefault(),e.Industries.destroy(t(this).data("id"))},create:function(e){void 0===_.findWhere(this.families.models,{name:e.name})&&(e.id=this.families.nextIndex,this.families.models.push(e),this.families.nextIndex++,t("body").trigger("industries:addOne",[e]))},destroy:function(e){var t;_.each(this.families.models,function(i,n,a){i.id!=e||(t=n)}),this.families.models.splice(t,1),this.addAll()},addAll:function(){t(".js-selected-families").empty(),_.each(e.Industries.families.models,function(t,i,n){e.Industries.addOne(null,t)})},addOne:function(e,i){t("#js-selected-families").append(this.nodeTemplate(i))},updateAppSelects:function(){var i=t(".application");i.empty(),_.each(e.Industries.applications.models,function(e,n,a){i.each(function(){t(this).append('<option value="'+e.name+'">'+e.name+"</option>")})})},slugify:function(e){return e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}},t(function(){wp.CAT.Industries.init()}),e}(wp.CAT||{},jQuery),wp.CAT=function(e,t){return e.Specs={init:function(){t(".js-spec-add").length&&this.bind()},bind:function(){t(document).on("click",".js-spec-add",this.addNewField),t(document).on("click",".js-spec-remove",this.removeField),t(".field-list").sortable({items:"li",helper:this.fixWidthHelper})},addNewField:function(e){e.preventDefault();var i=t(this);if($label=i.parent().prev().find(".add-field-name"),""!=$label.val()){var n=_.template(i.closest(".add-new-field").next(".fieldTemplate").html());i.closest(".add-new-field").prev(".field-list").append(n({label:$label.val()})),$label.val("")}else alert("Please fill in the field name.")},removeField:function(e){e.preventDefault(),t(this).parent().fadeOut("fast",function(){t(this).remove()})},fixWidthHelper:function(e,i){return i.children().children().each(function(){t(this).width(t(this).width())}),i}},t(function(){wp.CAT.Specs.init()}),e}(wp.CAT||{},jQuery),wp.CAT=function(e,t){return e.Videos={init:function(){t(".js-video-add").length&&this.bind()},bind:function(){t(document).on("click",".js-video-add",this.addNewField),t(document).on("click",".js-video-remove",this.removeField),t(".field-list").sortable({items:"li",helper:this.fixWidthHelper})},addNewField:function(e){e.preventDefault();var i=t(this),n=_.template(i.closest(".add-new-video").next(".videoTemplate").html());i.closest(".add-new-video").prev(".field-list").append(n({}))},removeField:function(e){e.preventDefault(),t(this).parent().fadeOut("fast",function(){t(this).remove()})},fixWidthHelper:function(e,i){return i.children().children().each(function(){t(this).width(t(this).width())}),i}},t(function(){wp.CAT.Videos.init()}),e}(wp.CAT||{},jQuery);
