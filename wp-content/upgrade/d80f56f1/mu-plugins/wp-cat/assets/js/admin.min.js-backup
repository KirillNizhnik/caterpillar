window.wp=window.wp||{},wp.CAT=function(CAT,$){return CAT.Featured={init:function(){$(".post_meta_featured_quick").on("change",this.updateState)},updateState:function(e){var $this=$(this),$val=$this.is(":checked")?1:0;$.post(ajaxurl,{checked:$val,post_id:$this.data("post_id"),action:"cat_new_update_featured_status"})}},$(function(){wp.CAT.Featured.init()}),CAT}(wp.CAT||{},jQuery),wp.CAT=function(CAT,$){return CAT.Features={init:function(){$(".js-feature-add").length&&this.bind()},bind:function(){$(document).on("click",".js-feature-add",this.addNewField),$(document).on("click",".js-feature-remove",this.removeField),$(".field-list").sortable({items:"li",helper:this.fixWidthHelper})},addNewField:function(event){event.preventDefault();var $this=$(this);if($value=$this.parent().parent().find(".add-field-name"),""==$value.val())return void alert("Please fill in the feature.");var $template=_.template($this.closest(".add-new-field").next(".fieldTemplate").html());$this.closest(".add-new-field").prev(".field-list").append($template({value:$value.val()})),$value.val("")},removeField:function(event){event.preventDefault(),$(this).parent().fadeOut("fast",function(){$(this).remove()})},fixWidthHelper:function(e,ui){return ui.children().children().each(function(){$(this).width($(this).width())}),ui}},$(function(){wp.CAT.Features.init()}),CAT}(wp.CAT||{},jQuery),wp.CAT=function(CAT,$){return CAT.TaxonomyImages={Media:null,target:null,init:function(){this.Media=wp.media.frames.downloadable_file=wp.media({title:"Choose an image",button:{text:"Select Image"},multiple:!1}),this.bind()},bind:function(){$(".js-img-add").on("click",this.openMediaFrame),$(".js-img-remove").on("click",this.destroy),this.Media.on("select",$.proxy(this.create,this))},openMediaFrame:function(event){event.preventDefault();var that=CAT.TaxonomyImages;that.target=$(this),that.Media.open()},create:function(){attachment=this.Media.state().get("selection").first().toJSON();var image="undefined"!=typeof attachment.sizes.medium?attachment.sizes.medium.url:attachment.sizes.thumbnail.url;this.target.parent().prepend('<img src="'+image+'" alt="" />'),this.target.siblings(".js-img-input").val(attachment.id),this.target.siblings(".js-img-remove").removeClass("hidden"),this.target.addClass("hidden")},destroy:function(event){event.preventDefault();var $this=$(this);$this.siblings(".js-img-input").val(""),$this.siblings("img").remove(),$this.siblings(".js-img-add").removeClass("hidden"),$this.addClass("hidden")}},CAT.MetaImages={Media:null,template:null,init:function(){$("#imageTemplate").length&&(this.Media=wp.media.frames.downloadable_file=wp.media({title:"Select Images",button:{text:"Select Image(s)"},multiple:!0}),this.template=_.template($("#imageTemplate").html()),this.bind())},bind:function(){$(".js-add-meta-image").on("click",this.openMediaFrame),$("body").on("click",".js-remove-meta-image",this.destroy),$(".js-sortable").sortable({scrollSensitivity:10,scroll:!1,placeholder:"cat-sortable-placeholder"}),this.Media.on("select",$.proxy(this.create,this))},openMediaFrame:function(event){event.preventDefault(),CAT.MetaImages.Media.open()},create:function(){var attachments=this.Media.state().get("selection");attachments.map(function(attachment){attachment=attachment.toJSON();var img={id:attachment.id,src:attachment.sizes.thumbnail.url};$(".js-cat-images").append(this.template(img))},this),$(".js-sortable").sortable("refresh")},destroy:function(event){event.preventDefault(),$(this).parent().remove()}},$(function(){wp.CAT.TaxonomyImages.init(),wp.CAT.MetaImages.init()}),CAT}(wp.CAT||{},jQuery),wp.CAT=function(CAT,$){return CAT.Importer={initialized:!1,init:function(){return this.initialized||this.bind(),this.initialized=!0,this},bind:function(){$(".js-importer-start").on("click",this.start)},start:function(event){event.preventDefault();var progress=new CAT.Progress;progress.start();var class_id=$(this).data("class"),wp_action="cat_new_import_class";"used"===class_id&&(wp_action="cat_used_import"),"rental"===class_id&&(wp_action="cat_rental_import"),"rental-purge"===class_id&&(wp_action="cat_rental_purge"),$.ajax({url:ajaxurl,type:"post",data:{action:wp_action,class_id:class_id}}).done(function(){progress.stop()})}},CAT.Progress=function(){this.el=null,this.timer=null,this.delay=1e3,this.percent=0,this.text="",this.template='<progress class="progress__bar js-progress-bar" value="0" max="100"></progress><span class="progress__text js-progress-text"></span>'},CAT.Progress.prototype.start=function(){var that=this;that.el=$(".progress").append(that.template),that.timer=setInterval(function(){that.send()},that.delay)},CAT.Progress.prototype.stop=function(){clearInterval(this.timer),this.el.empty()},CAT.Progress.prototype.send=function(){$.ajax({url:ajaxurl,type:"post",data:{action:"cat_progress_poll"},dataType:"json"}).done($.proxy(this.update,this))},CAT.Progress.prototype.update=function(data){"undefined"!=typeof data&&(this.percent=Math.floor(data.indexed/data.total*100),this.text=data.text,this.el.children(".js-progress-bar").val(this.percent),this.el.children(".js-progress-text").html(data.text+" - "+this.percent+"%"))},$(function(){wp.CAT.Importer.init()}),CAT}(wp.CAT||{},jQuery),wp.CAT=function(CAT,$){return CAT.Industries={initialized:!1,nodeTemplate:null,families:{nextIndex:1,models:[]},init:function(){return $("#familyNodeTemplate").length?(this.nodeTemplate=_.template($("#familyNodeTemplate").html()),this.initialized||(this.initialized=!0,this.bind()),console.log(window.IndustryFamilies),_.each(window.IndustryFamilies,function(el,i,list){this.create({object_id:"page"==el.type?el.ID:el.term_id,name:el.name,type:el.type})},this),this):void 0},bind:function(){$(".js-add-application").on("click",$.proxy(this.createApp,this)),$(".js-submit-add-to-industry").on("click",this.onAddClick),$("body").on("click",".js-remove-node",this.onRemoveClick),$("body").on("industries:addOne",$.proxy(this.addOne,this))},onSelectAllClick:function(event){event.preventDefault();var $class=$(this).closest(".family__terms"),$terms=$class.find('input[type="checkbox"]');$terms.each(function(){$(this).attr("checked","checked")})},onAddClick:function(event){var $class=$(this).closest(".family__terms"),$items=$class.find('input[type="checkbox"]').filter(":checked");$.each($items,function(){var $this=$(this);CAT.Industries.create({object_id:$this.val(),name:$this.data("name"),type:$this.data("type")})}),$class.find('input[type="checkbox"]').removeAttr("checked")},onRemoveClick:function(event){event.preventDefault(),CAT.Industries.destroy($(this).data("id"))},create:function(model){"undefined"==typeof _.findWhere(this.families.models,{name:model.name})&&(model.id=this.families.nextIndex,this.families.models.push(model),this.families.nextIndex++,$("body").trigger("industries:addOne",[model]))},destroy:function(id){var index;_.each(this.families.models,function(el,i,list){return el.id==id?void(index=i):void 0}),this.families.models.splice(index,1),this.addAll()},addAll:function(){$(".js-selected-families").empty(),_.each(CAT.Industries.families.models,function(el,i,list){CAT.Industries.addOne(null,el)})},addOne:function(event,model){$("#js-selected-families").append(this.nodeTemplate(model))},updateAppSelects:function(){var $applications=$(".application");$applications.empty(),_.each(CAT.Industries.applications.models,function(el,i,list){$applications.each(function(){$(this).append('<option value="'+el.name+'">'+el.name+"</option>")})})},slugify:function(text){return text.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}},$(function(){wp.CAT.Industries.init()}),CAT}(wp.CAT||{},jQuery),wp.CAT=function(CAT,$){return CAT.Specs={init:function(){$(".js-spec-add").length&&this.bind()},bind:function(){$(document).on("click",".js-spec-add",this.addNewField),$(document).on("click",".js-spec-remove",this.removeField),$(".field-list").sortable({items:"li",helper:this.fixWidthHelper})},addNewField:function(event){event.preventDefault();var $this=$(this);if($label=$this.parent().prev().find(".add-field-name"),""==$label.val())return void alert("Please fill in the field name.");var $template=_.template($this.closest(".add-new-field").next(".fieldTemplate").html());$this.closest(".add-new-field").prev(".field-list").append($template({label:$label.val()})),$label.val("")},removeField:function(event){event.preventDefault(),$(this).parent().fadeOut("fast",function(){$(this).remove()})},fixWidthHelper:function(e,ui){return ui.children().children().each(function(){$(this).width($(this).width())}),ui}},$(function(){wp.CAT.Specs.init()}),CAT}(wp.CAT||{},jQuery),wp.CAT=function(CAT,$){return CAT.Videos={init:function(){$(".js-video-add").length&&this.bind()},bind:function(){$(document).on("click",".js-video-add",this.addNewField),$(document).on("click",".js-video-remove",this.removeField),$(".field-list").sortable({items:"li",helper:this.fixWidthHelper})},addNewField:function(event){event.preventDefault();var $this=$(this),$template=_.template($this.closest(".add-new-video").next(".videoTemplate").html());$this.closest(".add-new-video").prev(".field-list").append($template({}))},removeField:function(event){event.preventDefault(),$(this).parent().fadeOut("fast",function(){$(this).remove()})},fixWidthHelper:function(e,ui){return ui.children().children().each(function(){$(this).width($(this).width())}),ui}},$(function(){wp.CAT.Videos.init()}),CAT}(wp.CAT||{},jQuery);
